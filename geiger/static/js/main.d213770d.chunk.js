(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{125:function(e,t,n){e.exports=function(){return new Worker(n.p+"c83ae2de066ce6fe08ee.worker.js")}},126:function(e,t,n){e.exports=n(312)},127:function(e,t,n){},132:function(e,t){},133:function(e,t){},134:function(e,t){},311:function(e,t,n){},312:function(e,t,n){"use strict";n.r(t);n(127);var i,r=n(4),o=n(2),s=n(3),a=n(15),u=n(14),h=n(16),d=function(){function e(){Object(o.a)(this,e),this._events={}}return Object(s.a)(e,[{key:"on",value:function(e,t,n){return e&&t?((this._events[e]||(this._events[e]=[])).push({callback:t,context:n||this}),this):this}},{key:"off",value:function(e,t){if(!this._events)return this;var n=this._events;return(e?[e]:Object.keys(n)).forEach(function(e){var i=n[e];if(i)if(t){var r=i.filter(function(e){return e.callback!==t});n[e]=r}else delete n[e]}),this}},{key:"trigger",value:function(e){if(!this._events||!e)return this;for(var t=this._events[e],n=this._events.all,i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return t&&this._triggerHandlers(t,r),n&&this._triggerHandlers(n,[e].concat(r)),this}},{key:"_triggerHandlers",value:function(e,t){e.forEach(function(e){e.callback.apply(e.context,t)})}}]),e}(),c=function(){function e(){Object(o.a)(this,e),this.graph=null}return Object(s.a)(e,[{key:"addTo",value:function(e){return this.graph=e,e.addCell(this),this}}]),e}(),l=function(e,t){return"c"+e+"n"+t},f=function(e,t,n){return l(e,t)+"input"+n},g=function(e,t,n){return l(e,t)+"output"+n},v=function(e,t,n){return l(e,t)+"$param$"+n},y=function(e,t){return e+" "+t},p=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(a.a)(this,Object(u.a)(t).call(this))).id=l(e.contextId,e.nodeId);var i=e.nodeType;return i.endsWith("Node")&&(i=i.slice(0,i.length-4)),n.type=i,n.nodeLabel=y(i,e.nodeId),n._size=null,n._pos=null,n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"getSize",value:function(){return this._size}},{key:"setSize",value:function(e){this._size=e}},{key:"getPos",value:function(){return this._pos}},{key:"setPos",value:function(e){return this._pos=e,this}},{key:"shouldRender",value:function(){return!!this._pos}}]),t}(c),m=n(50),_=n(26),k=n.n(_),w=function(){},b=function(){function e(t,n){Object(o.a)(this,e),this._items={},n=k()(n,{trackEnter:!1,trackExit:!1}),this._trackEnter=n.trackEnter,this._trackExit=n.trackExit,n.trackEnter&&(this._enter=[]),n.trackExit&&(this._exit=[]),t&&Object(m.isArray)(t)&&this.addItems(t)}return Object(s.a)(e,[{key:"add",value:function(e,t){if(2!==arguments.length)throw new Error("Should have two arguments, but got: "+arguments.length);if("undefined"===typeof e)throw new Error("id should not be undefined");return this._trackEnter&&this._enter.push(t),this.set(e,t),this}},{key:"addItems",value:function(e){var t=this;e.forEach(function(e){var n;!(n=e)||"object"!==typeof n&&"function"!==typeof n||t.add(e.id,e)})}},{key:"has",value:function(e){return this._items.hasOwnProperty(e)}},{key:"get",value:function(e){return this._items[e]}},{key:"set",value:function(e,t){return this._items[e]=t,this}},{key:"remove",value:function(e){return!!this.has(e)&&(this._trackExit&&this._exit.push(this._items[e]),delete this._items[e],!0)}},{key:"values",value:function(){return Object.values(this._items)}},{key:"size",value:function(){return Object.keys(this._items).length}},{key:"enter",value:function(){if(!this._trackEnter)throw new Error("Should set trackEnter=true");return this._enter}},{key:"exit",value:function(){if(!this._trackExit)throw new Error("Should set trackExit=true");return this._exit}},{key:"clearEnterExit",value:function(){this._trackEnter&&(this._enter=[]),this._trackExit&&(this._exit=[])}}]),e}(),x=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(a.a)(this,Object(u.a)(t).call(this)))._nodes=new b(null,{trackExit:!0}),e._edges=new b(null,{trackExit:!0}),e._out={},e._in={},e}return Object(h.a)(t,e),Object(s.a)(t,[{key:"addCell",value:function(e){e instanceof p?this.addNode(e):this.addEdge(e)}},{key:"addNode",value:function(e){this._nodes.add(e.id,e),this._shouldRedraw()}},{key:"removeNodeAndEdges",value:function(e){this.removeNode(e),this.removeEdgesOfNode(e)}},{key:"removeNode",value:function(e){this._nodes.remove(e),this._shouldRedraw()}},{key:"removeEdgesOfNode",value:function(e){var t=this,n=this._out[e];n&&Object.keys(n).forEach(function(e){t.removeEdge(e)});var i=this._in[e];i&&Object.keys(i).forEach(function(e){t.removeEdge(e)}),delete this._out[e],delete this._in[e]}},{key:"addEdge",value:function(e){var t=e.source.id;if(!this._out[t]||!this._out[t][e.id]){this._edges.add(e.id,e),this._out[t]||(this._out[t]={}),this._out[t][e.id]=!0;var n=e.target.id;this._in[n]||(this._in[n]={}),this._in[n][e.id]=!0,this._shouldRedraw()}}},{key:"removeEdge",value:function(e){var t=this._edges.get(e);if(t){var n=t.source.id;this._out[n]&&this._out[n][e]&&delete this._out[n][e];var i=t.target.id;this._in[i]&&this._in[i][e]&&delete this._in[i][e],this._edges.remove(e),this._shouldRedraw()}}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"getNodesToRemove",value:function(){return this._nodes.exit()}},{key:"getNode",value:function(e){return this._nodes.get(e)}},{key:"getEdges",value:function(){return this._edges.values()}},{key:"getEdgesToRemove",value:function(){return this._edges.exit()}},{key:"getEdge",value:function(e){return this._edges.get(e)}},{key:"_shouldRedraw",value:function(){this.trigger("shouldRedraw")}},{key:"renderEnd",value:function(){this._nodes.clearEnterExit(),this._edges.clearEnterExit()}}]),t}(d),E=n(70),P=n.n(E),O=n(32),N=n.n(O),j=n(125),I=n.n(j),R=[],S=function(e,t){var n=(t=k()(t||{callback:w})).marginX||0,i=t.marginY||0,r={rankdir:"LR",marginx:n,marginy:i},o=C(e,{directed:!0,setNodeLabel:M,setEdgeLabel:T});o.setGraph(r);var s=function(r){L(r,e,t),t.callback(function(e){var t=e.graph();return{marginx:n,marginy:i,width:Math.abs(t.width-2*n),height:Math.abs(t.height-2*i)}}(r))};t.useWorker?function(e){if(R.length)return R[0];var t=new I.a;return t.onmessage=function(t){var n=N.a.json.read(t.data);e(n)},R.push(t),t}(s).postMessage(N.a.json.write(o)):(P.a.layout(o,{debugTiming:!0}),s(o))},M=function(e){var t=e.getSize();return{width:t.width,height:t.height}},T=function(e){return{id:e.id}},C=function(e,t){var n=new P.a.graphlib.Graph,i=t.setNodeLabel||w,r=t.setEdgeLabel||w;return e.getNodes().forEach(function(e){n.setNode(e.id,i(e))}),e.getEdges().forEach(function(e){n.setEdge(e.source.id,e.target.id,r(e))}),n},L=function(e,t){e.nodes().forEach(function(n){var i=e.node(n);t.getNode(n).setPos({x:i.x,y:i.y})}),e.edges().forEach(function(n){var i=e.edge(n);t.getEdge(i.id).setPoints(i.points)})},A=function(e,t){switch(e){case"AudioDestination":return t?"#5D4037":"#37474F";case"AudioBufferSource":case"Oscillator":return"#009688";case"BiquadFilter":case"Convolver":case"Delay":case"DynamicsCompressor":case"IIRFilter":case"Panner":case"StereoPanner":case"WaveShaper":return"#2196F3";case"Analyser":return"#00BCD4";case"Gain":case"ChannelMerger":case"ChannelSplitter":return"#3F51B5";case"MediaElementAudioSource":case"MediaStreamAudioDestination":case"MediaStreamAudioSource":return"#9C27B0";case"ScriptProcessor":default:return"#C62828"}},z={IN:Symbol("IN"),OUT:Symbol("OUT"),PARAM:Symbol("PARAM")},W=function(e){var t=0;return e.getPorts().forEach(function(e){e.type===z.IN?t=10:e.type===z.PARAM&&0===t&&(t=5)}),t},U=function(e,t){var n,i,o,s;switch(e.type){case z.IN:n=5,i=-10,o=new r.fabric.Circle({radius:10,fill:"green",top:n,left:i,stroke:"black",strokeWidth:1}),s=new r.fabric.Text(e.text,{fontSize:14,fontFamily:"Segoe UI, sans-serif",fill:"black",top:n+2.5,left:i+6});break;case z.OUT:n=t.height/2-10,i=t.width-10,o=new r.fabric.Circle({radius:10,fill:"red",top:n,left:i,stroke:"black",strokeWidth:1}),s=new r.fabric.Text(e.text,{fontSize:14,fontFamily:"Segoe UI, sans-serif",fill:"black",left:i+6,top:n+2.5});break;case z.PARAM:o=new r.fabric.Circle({radius:5,fill:"yellow",top:(e.y||0)-5,left:-5,stroke:"black",strokeWidth:1}),s=new r.fabric.Text(e.text,{fontSize:12,fontFamily:"Segoe UI, sans-serif",fill:"#eee",left:12,top:(e.y||0)-5-2});break;default:throw new Error("should not reach here")}return new r.fabric.Group([o,s],{})},D=function(e,t){var n=Math.pow(10,t||0);return e.x=Math.round(e.x*n)/n,e.y=Math.round(e.y*n)/n,e},H=function(e,t,n){var i=function(e,t){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}(e,t);if(0===i)throw new Error("from should not be the same as to");return B(e,t,n/i)},B=function(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}},q=function(e,t,n,i){i=k()(i,{showControlPoints:!1});var o=t.getPoints(),s=o?o.slice(1,o.length-1):[],a=F(e,t,s),u=a.sourcePoint,h=a.targetPoint;n&&i.showControlPoints&&(X(n,u,{fill:"blue"}),X(n,h,{fill:"purple"}),s.forEach(function(e){X(n,e)}));var d=G(u,h,s),c=Y(u,h,s);return{path:new r.fabric.Path(d,{fill:"",stroke:"black",strokeWidth:1.5,selectable:!1}),arrowHead:new r.fabric.Path(c,{fill:"black",selectable:!1}),sourcePoint:u,targetPoint:h}},F=function(e,t,n){var i,r,o=t.source,s=e.getNode(o.id),a=s.getPos(),u=s.getSize(),h={x:a.x+u.width/2,y:a.y},d=t.target,c=e.getNode(d.id),l=c.getPortById(d.port),f=c.getPos(),g=c.getSize(),v={x:f.x-g.width/2,y:f.y-g.height/2+l.y};n.length?(i=n[0],r=n[n.length-1]):(i=v,r=h);var y=H(h,i,10),p=l.type===z.IN?10:5,m=H(v,r,p);return{sourcePoint:D(y),targetPoint:D(m)}},Y=function(e,t,n){var i,r=function(e,t){var n=-(t.y-e.y),i=t.x-e.x;return Math.atan2(n,i)}(n&&n.length?n[n.length-1]:e,t),o=[];return i=J("M",t),o.push(i),i=J("L",{x:t.x-12*Math.cos(-r-Math.PI/6),y:t.y-12*Math.sin(-r-Math.PI/6)}),o.push(i),i=J("L",{x:t.x-12*Math.cos(-r+Math.PI/6),y:t.y-12*Math.sin(-r+Math.PI/6)}),o.push(i),o.push("Z"),o.join(" ")},X=function(e,t,n){var i=(n=n||{}).radius||3,o=new r.fabric.Circle({radius:i,fill:n.fill||"black",top:t.y-i,left:t.x-i});e.add(o)},G=function(e,t,n){var i,r=[];i=J("M",e),r.push(i);for(var o,s,a,u,h,d,c,l=0,f=n.length;l<f;l++)o=n[l],s=n[l-1]||e,a=n[l+1]||t,u=V(s,o),h=V(o,a),d={x:1/3*u.x+2/3*o.x,y:2/3*o.y+1/3*u.y},c={x:1/3*h.x+2/3*o.x,y:2/3*o.y+1/3*h.y},i=J("L",u),r.push(i),i=K([d,c,h]),r.push(i);return i=J("L",t),r.push(i),r.join(" ")},J=function(e,t){return e+" "+t.x+" "+t.y},K=function(e){if(3!==e.length)throw new Error("should be 3 points but got ",e.length);var t=[];return t.push("C"),e.forEach(function(e){t.push(e.x),t.push(e.y)}),t.join(" ")},V=function(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}},Z=new b,$=function(e){if(!e||!e.id)throw new Error("rendered object is not returned or does not have id");Z.add(e.id,e)},Q=function(e,t){console.log("start render...");var n=performance.now();t.getNodes().forEach(function(t){var n;Z.has(t.id)?function(e,t){var n=t.getPos(),i=t.getSize(),r=W(t);e.set({left:Math.round(n.x-i.width/2-r),top:Math.round(n.y-i.height/2)}),e.setCoords()}(n=Z.get(t.id),t):t.shouldRender()&&(n=function(e,t){var n=t.getPos(),i=t.getSize(),o=[],s=new r.fabric.Rect({fill:A(t.type),width:i.width,height:i.height,rx:5,ry:5});o.push(s);var a=new r.fabric.Text(t.nodeLabel,{fontSize:14,fontFamily:"Segoe UI, sans-serif",fill:"#fff",left:12,top:9});o.push(a),t.getPorts().forEach(function(e){o.push(U(e,i))});var u=W(t),h=new r.fabric.Group(o,{id:t.id,left:Math.round(n.x-i.width/2-u),top:Math.round(n.y-i.height/2),hasRotatingPoint:!1,hasControls:!1,selectionBackgroundColor:"orange",hoverCursor:"pointer"});return e.add(h),h}(e,t),$(n))}),t.getNodesToRemove().forEach(function(t){var n=Z.get(t.id);e.remove(n),Z.remove(t.id)}),t.getEdges().forEach(function(n){var i;Z.has(n.id)?function(e,t,n){e.forEachObject(function(t){e.remove(t)});var i=q(n,t),r=i.path,o=i.arrowHead;e.addWithUpdate(r),e.addWithUpdate(o)}(i=Z.get(n.id),n,t):n.shouldRender()&&(i=function(e,t,n,i){var o=q(n,t,e,i),s=o.path,a=o.arrowHead,u=new r.fabric.Group([s,a],{id:t.id,hasRotatingPoint:!1,hasControls:!1,hasBorders:!1,evented:!1});return e.add(u),u}(e,n,t),$(i))}),t.getEdgesToRemove().forEach(function(t){var n=Z.get(t.id);e.remove(n),Z.remove(t.id)}),e.requestRenderAll(),t.renderEnd(),console.log("finish render, time spent: ",(performance.now()-n)/1e3,"s");var i=t.getNodes().length,o=t.getEdges().length;console.log("nodeNum:",i,"edgeNum:",o,"should render:",i+o,"rendered:",e.getObjects().length)},ee=function(){function e(t,n){Object(o.a)(this,e),this.canvas=t,this.graph=n,this._isRedrawPending=!1,this._isUsingWorker=!1,this._shouldRedrawNext=!1}return Object(s.a)(e,[{key:"init",value:function(){var e,t=this;this.resize(),this.graph.on("shouldRedraw",function(){t.requestRedraw()}),(e=this.canvas).on("mouse:down",function(e){var t=e.e;this.isDragging=!0,this.selection=!1,this.lastPosX=t.clientX,this.lastPosY=t.clientY}),e.on("mouse:move",function(e){if(this.isDragging){var t=e.e;this.viewportTransform[4]+=t.clientX-this.lastPosX,this.viewportTransform[5]+=t.clientY-this.lastPosY,this.requestRenderAll(),this.lastPosX=t.clientX,this.lastPosY=t.clientY}}),e.on("mouse:up",function(e){this.isDragging=!1,this.selection=!0,e.target&&console.log(e.target.id),this.forEachObject(function(e){e.setCoords()}),this.requestRenderAll()}),e.on("mouse:wheel",function(t){var n=t.e.deltaY,i=e.getZoom();(i-=n/300)>20&&(i=20),i<.1&&(i=.1),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},i),t.e.preventDefault(),t.e.stopPropagation()})}},{key:"resize",value:function(){var e={width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight};this._setCanvasSize(e),this.requestRedraw()}},{key:"_setCanvasSize",value:function(e){this.canvas.setWidth(e.width),this.canvas.setHeight(e.height)}},{key:"requestRedraw",value:function(){this._isRedrawPending||(this._isUsingWorker?this._shouldRedrawNext=!0:(this._isRedrawPending=!0,requestAnimationFrame(this._relayout.bind(this))))}},{key:"_relayout",value:function(){this._isRedrawPending=!1,this._isUsingWorker||(this._isUsingWorker=!0,console.log("start layout..."),this._startLayoutTime=performance.now(),S(this.graph,{marginX:20,marginY:20,useWorker:!0,callback:this._render.bind(this)}))}},{key:"_render",value:function(e){var t=this;this._isUsingWorker=!1,this._shouldRedrawNext&&(this._shouldRedrawNext=!1,this.requestRedraw()),console.log("finish layout, time spent: ",(performance.now()-this._startLayoutTime)/1e3,"s"),e&&(console.log("graph dimension",e.width,e.height),requestAnimationFrame(function(){Q(t.canvas,t.graph)})),console.log("redraw...")}}]),e}(),te="NODE_TO_NODE",ne="NODE_TO_PARAM",ie=function(e){function t(e,n){var i;return Object(o.a)(this,t),(i=Object(a.a)(this,Object(u.a)(t).call(this))).id=null,i.type=n,i.source=null,i.target=null,i._points=null,i._init(e),i}return Object(h.a)(t,e),Object(s.a)(t,[{key:"getPoints",value:function(){return this._points}},{key:"setPoints",value:function(e){this._points=e}},{key:"toString",value:function(){return[this.id,JSON.stringify(this.source),JSON.stringify(this.target)].join(",")}},{key:"shouldRender",value:function(){return!!this._points}},{key:"_init",value:function(e){var t,n,i=e.contextId;if(!e.sourceNodeId||!e.destinationNodeId)throw new Error("Undefined node message: "+JSON.stringify(e));if(this.source={id:l(i,e.sourceNodeId),port:g(i,e.sourceNodeId,e.fromChannel)},this.type===te)this.target={id:l(i,e.destinationNodeId),port:f(i,e.destinationNodeId,e.toChannel)};else{if(this.type!==ne)throw new Error("Unknown edge type: "+this.type);this.target={id:l(i,e.destinationNodeId),port:v(i,e.destinationNodeId,e.destinationParamName)}}this.id=(t=this.source.port,n=this.target.port,t+"|"+n)}}]),t}(c),re=(n(311),new(function(){function e(t){Object(o.a)(this,e);var n=document.getElementById(t);n||((n=document.createElement("div")).setAttribute("id",t),document.body.appendChild(n)),this.elem=n}return Object(s.a)(e,[{key:"start",value:function(e){this.elem.classList.add(e)}},{key:"stop",value:function(e){this.elem.classList.remove(e)}},{key:"setText",value:function(e){this.elem.textContent=e}},{key:"clientWidth",value:function(){return this.elem.clientWidth}}]),e}())("text-sandbox")),oe=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(a.a)(this,Object(u.a)(t).call(this,e)))._ports=null,n._init(e),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"getPortById",value:function(e){return this._ports.get(e)}},{key:"getPortsByType",value:function(e){return this._ports.filter(function(t){return t.type===e})}},{key:"getPorts",value:function(){return this._ports.values()}},{key:"_init",value:function(e){var t=this._computeNodeLayout(e),n=this._prepareInputPorts(e,t),i=this._prepareOutputPorts(e,t),r=this._prepareParamPorts(e,t);this._ports=this._createPortData(n.concat(i,r)),this.setSize({width:t.maxTextLength+12+30,height:t.totalHeight})}},{key:"_computeNodeLayout",value:function(e){var t=24*Math.max(1,e.numberOfInputs),n=14*e.audioParamNames.length,i=e.audioParamNames.length?6:8,r=Math.max(t+n+5+i,24*e.numberOfOutputs);return{inputPortSectionHeight:t,paramPortSectionHeight:n,maxTextLength:this._computeMaxTextLength(e),totalHeight:r}}},{key:"_computeMaxTextLength",value:function(e){var t=0;re.start("audioParamText");for(var n=0;n<e.audioParamNames.length;n++)re.setText(e.audioParamNames[n]),t=Math.max(t,re.clientWidth());return re.stop("audioParamText"),re.start("nodeText"),re.setText(this.nodeLabel),t=Math.max(t,re.clientWidth()),re.stop("nodeText"),t}},{key:"_prepareInputPorts",value:function(e,t){for(var n=[],i=15,r=0;r<e.numberOfInputs;r++)n.push({id:f(e.contextId,e.nodeId,r),type:z.IN,text:""+r,y:i}),i+=24;return n}},{key:"_prepareOutputPorts",value:function(e,t){for(var n=[],i=0;i<e.numberOfOutputs;i++)n.push({id:g(e.contextId,e.nodeId,i),type:z.OUT,text:""+i});return n}},{key:"_prepareParamPorts",value:function(e,t){for(var n=[],i=t.inputPortSectionHeight+5+5,r=0;r<e.audioParamNames.length;r++)n.push({id:v(e.contextId,e.nodeId,e.audioParamNames[r]),type:z.PARAM,text:e.audioParamNames[r],y:i}),i+=14;return n}},{key:"_createPortData",value:function(e){var t=this._validatePorts(e);if(t.length)throw new Error(t);return new b(e)}},{key:"_validatePorts",value:function(e){var t=this,n=[];return e.forEach(function(e){"object"!==typeof e&&n.push("Invalid port",e),t._isValidPortId(e.id)||n.push("port id is required")}),n}},{key:"_isValidPortId",value:function(e){return null!==e&&void 0!==e&&!Object(m.isObject)(e)}}]),t}(p),se=document.getElementById("toggle-iframe"),ae=document.getElementById("demo-iframe"),ue=new r.fabric.Canvas("root",{selection:!1}),he=new x,de=new ee(ue,he);window.addEventListener("load",function(){de.init()}),window.addEventListener("resize",function(){de.resize()}),i=he,window.addEventListener("message",function(e){var t=e.data;switch(t.eventType){case"KNodeCreated":new oe(t).addTo(i);break;case"kNodeDestroyed":var n=l(t.contextId,t.nodeId);i.removeNodeAndEdges(n);break;case"KNodesConnected":new ie(t,te).addTo(i);break;case"kNodeParamConnected":new ie(t,ne).addTo(i)}}),se.addEventListener("click",function(){ae.classList.contains("show")?(ae.classList.remove("show"),ae.classList.add("hide")):(ae.classList.remove("hide"),ae.classList.add("show"))})}},[[126,1,2]]]);
//# sourceMappingURL=main.d213770d.chunk.js.map